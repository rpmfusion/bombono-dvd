From 11f8b5a9cb2fc36c42103ddc6866836b4bf57f58 Mon Sep 17 00:00:00 2001
From: Ilya Murav'jov <muravev@yandex.ru>
Date: Sat, 9 Apr 2016 12:48:10 +0300
Subject: [PATCH 07/12] fixes

---
 src/mgui/ffviewer.cpp           | 6 +++---
 src/mgui/stream_utils.h         | 4 ++--
 src/mgui/tests/test_compile.cpp | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/mgui/ffviewer.cpp b/src/mgui/ffviewer.cpp
index c0677c2..64ea813 100644
--- a/src/mgui/ffviewer.cpp
+++ b/src/mgui/ffviewer.cpp
@@ -633,16 +633,16 @@ FFInfo::~FFInfo()
     CloseInfo(*this);
 }
 
-#if LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(57,5,00)
 static int bmd_avpicture_fill(AVFrame *picture, const uint8_t *ptr,
                               AVPixelFormat pix_fmt, int width, int height)
 {
+#if LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(57,5,00)
     return av_image_fill_arrays(picture->data, picture->linesize,
                                 ptr, pix_fmt, width, height, 1);
-}
 #else
-#define bmd_avpicture_fill avpicture_fill
+    return avpicture_fill((AVPicture*)picture, ptr, pix_fmt, width, height);
 #endif
+}
 
 bool FFViewer::Open(const char* fname, std::string& err_str)
 {
diff --git a/src/mgui/stream_utils.h b/src/mgui/stream_utils.h
index 3caa492..6f91600 100644
--- a/src/mgui/stream_utils.h
+++ b/src/mgui/stream_utils.h
@@ -42,8 +42,8 @@ class stream
                 stream(std::iostream& strm): io_strm(strm) {}
 
  std::iostream& strm() { return io_strm; }
-                operator void*() const { return (void*)io_strm; }
-          bool  operator!() const { return !operator void*(); }
+                //operator void*() const { return (void*)io_strm; }
+          //bool  operator!() const { return !operator void*(); }
         stream& seekg(streamoff off, ios_base::seekdir dir)
                 { io_strm.seekg(off, dir); return *this; }
         stream& seekp(streamoff off, ios_base::seekdir dir)
diff --git a/src/mgui/tests/test_compile.cpp b/src/mgui/tests/test_compile.cpp
index 95f91be..0bbc364 100644
--- a/src/mgui/tests/test_compile.cpp
+++ b/src/mgui/tests/test_compile.cpp
@@ -44,7 +44,7 @@ BOOST_AUTO_TEST_CASE( test_lambda )
     std::for_each(r_lst.begin(), r_lst.end(), (
         lambda::var(cut_rct) = lambda::bind(Intersection<int>, lambda::_1, ref(plc_rct)),
         lambda::if_then( !lambda::bind(&RectT<int>::IsNull, lambda::var(cut_rct)),
-            lambda::bind(&DrwFunctor::operator(), ref(drw_fnr), lambda::var(cut_rct)) )
+            lambda::bind(&DrwFunctor::operator(), drw_fnr, lambda::var(cut_rct)) )
                                               ) );
 }
 
-- 
2.7.4

